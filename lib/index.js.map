{"version":3,"file":"index.js","sources":["../src/util.ts","../src/ObserverItem.tsx","../src/VirtList.tsx","../src/RealList.tsx"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { isVue2 } from 'vue-demi';\nimport type { RawChildren } from './type';\n\nexport function polyfillAttr(\n  rest: Record<string, any>,\n  attrs: Record<string, any>,\n) {\n  return isVue2\n    ? {\n        ...rest,\n        attrs: attrs,\n      }\n    : {\n        ...rest,\n        ...attrs,\n      };\n}\n\nexport function polyfillChildren(children: any[]): RawChildren {\n  return isVue2\n    ? children\n    : {\n        default: () => children,\n      };\n}\n\nexport function polyfillSlot(slot: any) {\n  return isVue2 ? slot : slot?.();\n}\n","import { defineComponent, h, onBeforeUnmount, onMounted, ref } from 'vue-demi';\nimport type { ObserverItemProps } from './type';\nimport { polyfillSlot, polyfillAttr } from './util';\n\nconst useObserverItem = (props: ObserverItemProps) => {\n  const itemRefEl = ref(null);\n\n  onMounted(() => {\n    if (props.resizeObserver && itemRefEl.value) {\n      props.resizeObserver.observe(itemRefEl.value);\n    }\n  });\n\n  onBeforeUnmount(() => {\n    if (props.resizeObserver && itemRefEl.value) {\n      props.resizeObserver.unobserve(itemRefEl.value);\n    }\n  });\n\n  return {\n    itemRefEl,\n  };\n};\nconst ObserverItem = defineComponent({\n  name: 'ObserverItem',\n  props: {\n    resizeObserver: {\n      type: ResizeObserver,\n      require: true,\n    },\n    id: {\n      type: [String, Number],\n      require: true,\n    },\n  },\n  setup(props) {\n    return useObserverItem(props as ObserverItemProps);\n  },\n  render() {\n    const { id } = this;\n    return h(\n      'div',\n      polyfillAttr(\n        { ref: 'itemRefEl' },\n        {\n          'data-id': id,\n        },\n      ),\n      [polyfillSlot(this.$slots.default)],\n    );\n  },\n});\n\nexport { ObserverItem, useObserverItem };\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport {\n  isVue2,\n  defineComponent,\n  onBeforeMount,\n  onMounted,\n  onBeforeUnmount,\n  shallowReactive,\n  ref,\n  shallowRef,\n  watch,\n  h,\n  type ShallowRef,\n  type ShallowReactive,\n  type VNodeChild,\n  type VNode,\n  type SetupContext,\n} from 'vue-demi';\nimport { ObserverItem } from './ObserverItem';\nimport type {\n  EmitFunction,\n  ReactiveData,\n  SlotSize,\n  VirtListProps,\n  VirtListReturn,\n} from './type';\nimport { polyfillSlot, polyfillAttr, polyfillChildren } from './util';\n\nconst defaultProps = {\n  fixed: false,\n  buffer: 0,\n  bufferTop: 0,\n  bufferBottom: 0,\n  scrollDistance: 0,\n  horizontal: false,\n  fixSelection: false,\n  start: 0,\n  offset: 0,\n  listStyle: '',\n  listClass: '',\n  itemStyle: '',\n  itemClass: '',\n  headerClass: '',\n  headerStyle: '',\n  footerClass: '',\n  footerStyle: '',\n  stickyHeaderClass: '',\n  stickyHeaderStyle: '',\n  stickyFooterClass: '',\n  stickyFooterStyle: '',\n};\n\nfunction useVirtList<T extends Record<string, any>>(\n  userProps: ShallowReactive<VirtListProps<T>>,\n  emitFunction?: EmitFunction<T>,\n): VirtListReturn<T> {\n  const props = new Proxy(userProps, {\n    get(target, key) {\n      return Reflect.get(target, key) ?? Reflect.get(defaultProps, key);\n    },\n  }) as Required<VirtListProps<T>>;\n\n  const clientRefEl = ref<HTMLElement | null>(null);\n  const listRefEl = ref<HTMLElement | null>(null);\n  const headerRefEl = ref<HTMLElement | null>(null);\n  const footerRefEl = ref<HTMLElement | null>(null);\n  const stickyHeaderRefEl = ref<HTMLElement | null>(null);\n  const stickyFooterRefEl = ref<HTMLElement | null>(null);\n\n  const sizesMap = new Map();\n  const renderKey = ref(0);\n  let direction: 'forward' | 'backward' = 'backward';\n  // ä¸€ä¸ªæ‰‹åŠ¨è®¾ç½®æ»šåŠ¨çš„æ ‡å¿—ä½ï¼Œç”¨æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦çº æ­£æ»šåŠ¨ä½ç½®\n  let fixOffset = false;\n  let forceFixOffset = false;\n  let abortFixOffset = false;\n\n  const slotSize: ShallowReactive<SlotSize> = shallowReactive({\n    clientSize: 0,\n    headerSize: 0,\n    footerSize: 0,\n    stickyHeaderSize: 0,\n    stickyFooterSize: 0,\n  });\n\n  // å…¨å±€éœ€è¦å“åº”å¼çš„æ•°æ®\n  const reactiveData: ShallowReactive<ReactiveData> = shallowReactive({\n    // å¯è§†åŒºåŸŸçš„ä¸ªæ•°ï¼Œä¸ç®—bufferï¼Œåªå’ŒclientSizeå’ŒminSizeæœ‰å…³\n    views: 0,\n\n    // æ»šåŠ¨è·ç¦»\n    offset: 0,\n    // ä¸åŒ…å«æ’æ§½çš„é«˜åº¦\n    listTotalSize: 0,\n    // è™šæ‹Ÿå ä½å°ºå¯¸ï¼Œæ˜¯ä»0åˆ°renderBeginçš„å°ºå¯¸\n    virtualSize: 0,\n    // å¯è§†åŒºçš„èµ·å§‹ä¸‹æ ‡\n    inViewBegin: 0,\n    // å¯è§†åŒºçš„ç»“æŸä¸‹æ ‡\n    inViewEnd: 0,\n\n    // bufferçš„èµ·å§‹ä¸‹æ ‡\n    renderBegin: 0,\n    // bufferçš„ç»“æŸä¸‹æ ‡\n    renderEnd: 0,\n\n    bufferTop: 0,\n    bufferBottom: 0,\n  });\n\n  function getOffset() {\n    const directionKey = props.horizontal ? 'scrollLeft' : 'scrollTop';\n    return clientRefEl.value ? clientRefEl.value[directionKey] : 0;\n  }\n  function getSlotSize() {\n    return (\n      slotSize.headerSize +\n      slotSize.footerSize +\n      slotSize.stickyHeaderSize +\n      slotSize.stickyFooterSize\n    );\n  }\n  function getTotalSize() {\n    return (\n      reactiveData.listTotalSize +\n      slotSize.headerSize +\n      slotSize.footerSize +\n      slotSize.stickyHeaderSize +\n      slotSize.stickyFooterSize\n    );\n  }\n  function getItemSize(itemKey: string) {\n    if (props.fixed) return props.minSize;\n    return sizesMap.get(String(itemKey)) ?? props.minSize;\n  }\n  function setItemSize(itemKey: string, size: number) {\n    sizesMap.set(String(itemKey), size);\n  }\n  function deleteItemSize(itemKey: string) {\n    sizesMap.delete(String(itemKey));\n  }\n  // é€šè¿‡ä¸‹æ ‡æ¥è·å–å…ƒç´ ä½ç½®ä¿¡æ¯\n  function getItemPosByIndex(index: number) {\n    if (props.fixed) {\n      return {\n        top: props.minSize * index,\n        current: props.minSize,\n        bottom: props.minSize * (index + 1),\n      };\n    }\n\n    const { itemKey } = props;\n    let topReduce = slotSize.headerSize;\n    for (let i = 0; i <= index - 1; i += 1) {\n      const currentSize = getItemSize(props.list[i]?.[itemKey]);\n      topReduce += currentSize;\n    }\n    const current = getItemSize(props.list[index]?.[itemKey]);\n    return {\n      top: topReduce,\n      current,\n      bottom: topReduce + current,\n    };\n  }\n\n  function scrollToOffset(offset: number) {\n    abortFixOffset = true;\n    const directionKey = props.horizontal ? 'scrollLeft' : 'scrollTop';\n    if (clientRefEl.value) clientRefEl.value[directionKey] = offset;\n  }\n  // expose æ»šåŠ¨åˆ°æŒ‡å®šä¸‹æ ‡\n  async function scrollToIndex(index: number) {\n    console.log('scrollToIndex', index);\n\n    if (index < 0) {\n      return;\n    }\n\n    // å¦‚æœè¦å»çš„ä½ç½®å¤§äºé•¿åº¦ï¼Œé‚£ä¹ˆå°±ç›´æ¥è°ƒç”¨å»åº•éƒ¨çš„æ–¹æ³•\n    if (index >= props.list.length - 1) {\n      scrollToBottom();\n      return;\n    }\n\n    let { top: lastOffset } = getItemPosByIndex(index);\n    const recursion = async () => {\n      scrollToOffset(lastOffset);\n\n      setTimeout(() => {\n        // ç¬¬äºŒæ¬¡çœ‹ä¸€ä¸‹æœ‰æ²¡æœ‰éœ€è¦ä¿®æ­£çš„æƒ…å†µ\n        const { top: offset } = getItemPosByIndex(index);\n        // æŸ¥çœ‹ä½ç½®æ˜¯å¦æœ‰ä¿®æ­£ï¼Œæœ‰ä¿®æ­£å°±é€’å½’è‡ªå·±\n        if (lastOffset !== offset) {\n          lastOffset = offset;\n          recursion();\n        }\n      }, 3);\n    };\n    recursion();\n  }\n  // expose æ»šåŠ¨åˆ°å¯è§†åŒºåŸŸ\n  async function scrollIntoView(index: number) {\n    const { top: targetMin, bottom: targetMax } = getItemPosByIndex(index);\n    const offsetMin = getOffset();\n    const offsetMax = getOffset() + slotSize.clientSize;\n    const currentSize = getItemSize(props.list[index]?.[props.itemKey]);\n    if (\n      targetMin < offsetMin &&\n      offsetMin < targetMax &&\n      currentSize < slotSize.clientSize\n    ) {\n      // å¦‚æœç›®æ ‡å…ƒç´ ä¸Šæ–¹çœ‹ä¸åˆ°ï¼Œåº•éƒ¨çœ‹å¾—åˆ°ï¼Œé‚£ä¹ˆæ»šåŠ¨åˆ°é¡¶éƒ¨éƒ¨çœ‹å¾—åˆ°å°±è¡Œäº†\n      scrollToOffset(targetMin);\n      return;\n    }\n    if (\n      targetMin + slotSize.stickyHeaderSize < offsetMax &&\n      offsetMax < targetMax + slotSize.stickyHeaderSize &&\n      currentSize < slotSize.clientSize\n    ) {\n      // å¦‚æœç›®æ ‡å…ƒç´ ä¸Šæ–¹çœ‹å¾—åˆ°ï¼Œåº•éƒ¨çœ‹ä¸åˆ°ï¼Œé‚£ä¹ˆæ»šåŠ¨åˆ°åº•éƒ¨çœ‹å¾—åˆ°å°±è¡Œäº†\n      scrollToOffset(\n        targetMax - slotSize.clientSize + slotSize.stickyHeaderSize,\n      );\n      return;\n    }\n\n    // å±å¹•ä¸‹æ–¹\n    if (targetMin + slotSize.stickyHeaderSize >= offsetMax) {\n      scrollToIndex(index);\n      return;\n    }\n\n    // å±å¹•ä¸Šæ–¹\n    if (targetMax <= offsetMin) {\n      scrollToIndex(index);\n      return;\n    }\n\n    // åœ¨ä¸­é—´å°±ä¸åŠ¨äº†\n  }\n  // expose æ»šåŠ¨åˆ°é¡¶éƒ¨ï¼Œè¿™ä¸ªå’Œå»ç¬¬ä¸€ä¸ªå…ƒç´ ä¸åŒ\n  async function scrollToTop() {\n    scrollToOffset(0);\n\n    setTimeout(() => {\n      const directionKey = props.horizontal ? 'scrollLeft' : 'scrollTop';\n      // å› ä¸ºçº æ­£æ»šåŠ¨æ¡ä¼šæœ‰è¯¯å·®ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦å†æ¬¡çº æ­£\n      if (clientRefEl?.value?.[directionKey] !== 0) {\n        scrollToTop();\n      }\n    }, 3);\n  }\n  // expose æ»šåŠ¨åˆ°åº•éƒ¨\n  async function scrollToBottom() {\n    scrollToOffset(getTotalSize());\n\n    setTimeout(() => {\n      // ä¿®å¤åº•éƒ¨è¯¯å·®ï¼Œå› ä¸ºç¼©æ”¾å±å¹•çš„æ—¶å€™ï¼Œè·å–çš„å°ºå¯¸éƒ½æ˜¯å°æ•°ï¼Œç²¾åº¦ä¼šæœ‰é—®é¢˜ï¼Œè¿™é‡ŒæŠŠè¯¯å·®è°ƒæ•´ä¸º2px\n      if (\n        Math.abs(\n          Math.round(reactiveData.offset + slotSize.clientSize) -\n            Math.round(getTotalSize()),\n        ) > 2\n      ) {\n        scrollToBottom();\n      }\n    }, 3);\n  }\n\n  // ä¿®å¤vue2-diffçš„bugå¯¼è‡´çš„selectioné—®é¢˜\n  function fixSelection() {\n    const selection = window.getSelection();\n    if (selection) {\n      const { anchorNode, anchorOffset, focusNode, focusOffset } = selection;\n      if (\n        anchorNode &&\n        anchorOffset !== null &&\n        focusNode !== null &&\n        focusOffset\n      ) {\n        requestAnimationFrame(() => {\n          if (anchorOffset < focusOffset) {\n            selection.setBaseAndExtent(\n              anchorNode,\n              anchorOffset,\n              focusNode,\n              focusOffset,\n            );\n          } else {\n            selection.setBaseAndExtent(\n              focusNode,\n              focusOffset,\n              anchorNode,\n              anchorOffset,\n            );\n          }\n        });\n      }\n    }\n  }\n\n  function updateRange(start: number) {\n    // ä¿®å¤vue2-diffçš„bug\n    if (isVue2 && props.fixSelection && direction === 'backward') {\n      fixSelection();\n    }\n\n    reactiveData.inViewBegin = start;\n    reactiveData.inViewEnd = Math.min(\n      start + reactiveData.views,\n      props.list.length - 1,\n    );\n  }\n\n  function calcRange() {\n    const { views, offset, inViewBegin } = reactiveData;\n    const { itemKey } = props;\n\n    const offsetWithNoHeader = offset - slotSize.headerSize;\n    let start = inViewBegin;\n    let offsetReduce = getVirtualSize2beginInView();\n\n    // å½“æœ‰é¡¶éƒ¨æ’æ§½çš„æ—¶å€™ï¼Œå¿«é€Ÿæ»šåŠ¨åˆ°é¡¶éƒ¨ï¼Œåˆ™éœ€è¦åˆ¤æ–­ï¼Œå¹¶ç›´æ¥ä¿®æ­£\n    if (offsetWithNoHeader < 0) {\n      updateRange(0);\n      return;\n    }\n\n    if (direction === 'forward') {\n      // 1. æ²¡å‘ç”Ÿå˜åŒ–\n      if (offsetWithNoHeader >= offsetReduce) {\n        // console.log(`ğŸ‘†ğŸ»ğŸ‘†ğŸ»ğŸ‘†ğŸ»ğŸ‘†ğŸ» for break æ²¡å˜ start ${start}`);\n        return;\n      }\n      for (let i = start - 1; i >= 0; i -= 1) {\n        // 2. å˜åŒ–äº†\n        const currentSize = getItemSize(props.list[i]?.[itemKey]);\n        offsetReduce -= currentSize;\n        // è¦è®¡ç®—2ä¸ªheaderæ’æ§½çš„é«˜åº¦\n        if (\n          offsetReduce <= offsetWithNoHeader &&\n          offsetWithNoHeader < offsetReduce + currentSize\n        ) {\n          start = i;\n          // console.log(`ğŸ‘†ğŸ»ğŸ‘†ğŸ»ğŸ‘†ğŸ»ğŸ‘†ğŸ» for break å˜äº† start ${start}`);\n          break;\n        }\n      }\n\n      // å‘ä¸Šæ»šåŠ¨éœ€è¦ä¿®æ­£\n      fixOffset = true;\n    }\n\n    if (direction === 'backward') {\n      if (offsetWithNoHeader <= offsetReduce) {\n        // console.log(`ğŸ‘†ğŸ»ğŸ‘†ğŸ»ğŸ‘†ğŸ»ğŸ‘†ğŸ» for break æ²¡å˜ start ${start}`);\n        return;\n      }\n      for (let i = start; i <= props.list.length - 1; i += 1) {\n        // 2. å˜åŒ–äº†\n        const currentSize = getItemSize(props.list[i]?.[itemKey]);\n        // console.log('currentSize', i, props.list[i]?.[itemKey], currentSize);\n\n        if (\n          offsetReduce <= offsetWithNoHeader &&\n          offsetWithNoHeader < offsetReduce + currentSize\n        ) {\n          start = i;\n          break;\n        }\n        offsetReduce += currentSize;\n      }\n\n      // å‘ä¸‹æ»šåŠ¨ä¸éœ€è¦ä¿®æ­£\n      fixOffset = false;\n    }\n\n    // èŠ‚æµ\n    if (start !== reactiveData.inViewBegin) {\n      updateRange(start);\n    }\n  }\n\n  function onScroll(evt: Event) {\n    // console.log('onscroll');\n\n    emitFunction?.scroll?.(evt);\n\n    const offset = getOffset();\n\n    if (offset === reactiveData.offset) return;\n    direction = offset < reactiveData.offset ? 'forward' : 'backward';\n    reactiveData.offset = offset;\n\n    calcRange();\n\n    // åˆ°è¾¾é¡¶éƒ¨\n    if (\n      direction === 'forward' &&\n      reactiveData.offset - props.scrollDistance <= 0\n    ) {\n      console.log('[VirtList] åˆ°è¾¾é¡¶éƒ¨');\n      emitFunction?.toTop?.(props.list[0]);\n    }\n    // åˆ°è¾¾åº•éƒ¨ - æ”¾åœ¨è¿™é‡Œæ˜¯ä¸ºäº†æ¸²æŸ“å®Œæˆæ‹¿åˆ°çœŸæ˜¯é«˜åº¦äº†ï¼Œå†åˆ¤æ–­æ˜¯å¦æ˜¯çœŸçš„åˆ°è¾¾åº•éƒ¨\n    // ä½¿ç”¨ä¸€ä¸ª Math.round æ¥è§£å†³å°æ•°ç‚¹çš„è¯¯å·®é—®é¢˜\n    if (\n      direction === 'backward' &&\n      Math.round(reactiveData.offset + props.scrollDistance) >=\n        Math.round(\n          reactiveData.listTotalSize + getSlotSize() - slotSize.clientSize,\n        )\n    ) {\n      console.log('[VirtList] åˆ°è¾¾åº•éƒ¨');\n      emitFunction?.toBottom?.(props.list[props.list.length - 1]);\n    }\n  }\n\n  function calcViews() {\n    // ä¸ç®—bufferçš„ä¸ªæ•°\n    const newViews = Math.ceil(slotSize.clientSize / props.minSize) + 1;\n    reactiveData.views = newViews;\n  }\n\n  function onClientResize() {\n    // å¯è§†åŒºåŸŸå°ºå¯¸å˜åŒ– => 1. æ›´æ–°å¯è§†åŒºåŸŸä¸ªæ•° 2. å¯è§†åŒºåŸŸä¸ªæ•°å˜åŒ–åéœ€è¦åŠæ—¶æ›´æ–°è®°å½•å°ºå¯¸\n    calcViews();\n    updateRange(reactiveData.inViewBegin);\n  }\n\n  function calcListTotalSize() {\n    if (props.fixed) {\n      reactiveData.listTotalSize = props.minSize * props.list.length;\n      return;\n    }\n    const { itemKey } = props;\n    let re = 0;\n    for (let i = 0; i <= props.list.length - 1; i += 1) {\n      re += getItemSize(props.list[i]?.[itemKey]);\n    }\n    reactiveData.listTotalSize = re;\n  }\n\n  function reset() {\n    console.log('[VirtList] reset');\n\n    reactiveData.offset = 0;\n    reactiveData.listTotalSize = 0;\n    reactiveData.virtualSize = 0;\n\n    reactiveData.inViewBegin = 0;\n    reactiveData.inViewEnd = 0;\n\n    reactiveData.renderBegin = 0;\n    reactiveData.renderEnd = 0;\n    sizesMap.clear();\n  }\n  // expose only\n  function deletedList2Top(deletedList: T[]) {\n    calcListTotalSize();\n    let deletedListSize = 0;\n    deletedList.forEach((item) => {\n      deletedListSize += getItemSize(item[props.itemKey]);\n    });\n    updateTotalVirtualSize();\n    scrollToOffset(reactiveData.offset - deletedListSize);\n    calcRange();\n  }\n  // expose only\n  function addedList2Top(addedList: T[]) {\n    calcListTotalSize();\n    let addedListSize = 0;\n    addedList.forEach((item) => {\n      addedListSize += getItemSize(item[props.itemKey]);\n    });\n    updateTotalVirtualSize();\n    scrollToOffset(reactiveData.offset + addedListSize);\n    forceFixOffset = true;\n    abortFixOffset = false;\n    calcRange();\n  }\n\n  function forceUpdate() {\n    renderKey.value += 1;\n  }\n\n  let resizeObserver: ResizeObserver | undefined = undefined;\n  if (typeof ResizeObserver !== 'undefined') {\n    resizeObserver = new ResizeObserver((entries) => {\n      // FIXME è¿™é‡ŒåŠ äº†requestIdleCallbackä¼šæœ‰é—®é¢˜ï¼Œæš‚æ—¶ä¸çŸ¥é“ä¸ºä»€ä¹ˆ\n      // å»¶è¿Ÿæ‰§è¡Œï¼Œå¿«é€Ÿæ»šåŠ¨çš„æ—¶å€™æ˜¯æ²¡æœ‰å¿…è¦çš„\n      // requestIdleCallback(() => {\n      let diff = 0;\n      for (const entry of entries) {\n        const id = (entry.target as HTMLElement).dataset.id;\n\n        if (id) {\n          const oldSize = getItemSize(id);\n\n          let newSize = 0;\n          // å…¼å®¹æ€§å¤„ç†ï¼Œè¯¦æƒ…ï¼šhttps://developer.mozilla.org/zh-CN/docs/Web/API/ResizeObserver\n          // iosä¸­æ²¡æœ‰borderBoxSizeï¼Œåªæœ‰contentRect\n          if (entry.borderBoxSize) {\n            // Firefox implements `contentBoxSize` as a single content rect, rather than an array\n            const contentBoxSize = Array.isArray(entry.contentBoxSize)\n              ? entry.contentBoxSize[0]\n              : entry.contentBoxSize;\n            newSize = props.horizontal\n              ? contentBoxSize.inlineSize\n              : contentBoxSize.blockSize;\n          } else {\n            newSize = props.horizontal\n              ? entry.contentRect.width\n              : entry.contentRect.height;\n          }\n\n          if (id === 'client') {\n            slotSize.clientSize = newSize;\n            onClientResize();\n          } else if (id === 'header') {\n            slotSize.headerSize = newSize;\n          } else if (id === 'footer') {\n            slotSize.footerSize = newSize;\n          } else if (id === 'stickyHeader') {\n            slotSize.stickyHeaderSize = newSize;\n          } else if (id === 'stickyFooter') {\n            slotSize.stickyFooterSize = newSize;\n          } else if (oldSize !== newSize) {\n            setItemSize(id, newSize);\n            diff += newSize - oldSize;\n            emitFunction?.itemResize?.(id, newSize);\n          }\n        }\n      }\n      reactiveData.listTotalSize += diff;\n      // console.log(fixOffset, forceFixOffset, diff);\n      // å‘ä¸Šæ»šåŠ¨çº æ­£è¯¯å·® - å½“æ²¡æœ‰é¡¶éƒ¨bufferçš„æ—¶å€™æ˜¯éœ€è¦çš„\n      if ((fixOffset || forceFixOffset) && diff !== 0 && !abortFixOffset) {\n        fixOffset = false;\n        forceFixOffset = false;\n        scrollToOffset(reactiveData.offset + diff);\n        // console.log('çº æ­£è¯¯å·®', reactiveData.offset, diff);\n      }\n      abortFixOffset = false;\n    });\n  }\n\n  const updateTotalVirtualSize = () => {\n    let offset = 0;\n    const currentFirst = reactiveData.renderBegin;\n    for (let i = 0; i < currentFirst; i++) {\n      offset += getItemSize(props.list[i]?.[props.itemKey]);\n    }\n    reactiveData.virtualSize = offset;\n  };\n\n  onBeforeMount(() => {\n    if (props.bufferTop) {\n      reactiveData.bufferTop = props.bufferTop;\n    } else {\n      reactiveData.bufferTop = props.buffer;\n    }\n\n    if (props.bufferBottom) {\n      reactiveData.bufferBottom = props.bufferBottom;\n    } else {\n      reactiveData.bufferBottom = props.buffer;\n    }\n  });\n\n  onMounted(() => {\n    if (clientRefEl.value) {\n      clientRefEl.value.addEventListener('scroll', onScroll);\n\n      resizeObserver?.observe(clientRefEl.value);\n    }\n\n    if (stickyHeaderRefEl.value) {\n      resizeObserver?.observe(stickyHeaderRefEl.value);\n    }\n    if (stickyFooterRefEl.value) {\n      resizeObserver?.observe(stickyFooterRefEl.value);\n    }\n    if (headerRefEl.value) {\n      resizeObserver?.observe(headerRefEl.value);\n    }\n    if (footerRefEl.value) {\n      resizeObserver?.observe(footerRefEl.value);\n    }\n\n    if (props.start) {\n      scrollToIndex(props.start);\n    } else if (props.offset) {\n      scrollToOffset(props.offset);\n    }\n  });\n\n  onBeforeUnmount(() => {\n    if (clientRefEl.value) {\n      clientRefEl.value.removeEventListener('scroll', onScroll);\n\n      resizeObserver?.unobserve(clientRefEl.value);\n      slotSize.clientSize = 0;\n    }\n\n    if (stickyHeaderRefEl.value) {\n      resizeObserver?.unobserve(stickyHeaderRefEl.value);\n      slotSize.stickyHeaderSize = 0;\n    }\n    if (stickyFooterRefEl.value) {\n      resizeObserver?.unobserve(stickyFooterRefEl.value);\n      slotSize.stickyFooterSize = 0;\n    }\n    if (headerRefEl.value) {\n      resizeObserver?.unobserve(headerRefEl.value);\n      slotSize.headerSize = 0;\n    }\n    if (footerRefEl.value) {\n      resizeObserver?.unobserve(footerRefEl.value);\n      slotSize.footerSize = 0;\n    }\n  });\n\n  function getVirtualSize2beginInView() {\n    return (\n      reactiveData.virtualSize +\n      getRangeSize(reactiveData.renderBegin, reactiveData.inViewBegin)\n    );\n  }\n\n  function getRangeSize(range1: number, range2: number) {\n    const start = Math.min(range1, range2);\n    const end = Math.max(range1, range2);\n    let re = 0;\n    for (let i = start; i < end; i += 1) {\n      re += getItemSize(props.list[i]?.[props.itemKey]);\n    }\n    return re;\n  }\n\n  const renderList: ShallowRef<T[]> = shallowRef([]);\n  watch(\n    // è¿™é‡Œä¸ºä»€ä¹ˆç”¨ renderKey ä»£æ›¿ç›‘å¬ props.list\n    // å› ä¸ºprops.listä¼šå¯¼è‡´v-foræ—¶deepArrayå¯¼è‡´å¤§é‡çš„æ€§èƒ½æµªè´¹\n    () => [reactiveData.inViewBegin, reactiveData.inViewEnd, renderKey.value],\n    (newVal, oldVal) => {\n      if (newVal && oldVal) {\n        // console.log('watch', newVal, oldVal);\n        const [_newInViewBegin] = newVal;\n\n        // æ—§çš„æ¸²æŸ“èµ·å§‹\n        const _oldRenderBegin = reactiveData.renderBegin;\n\n        // æ–°çš„æ¸²æŸ“èµ·å§‹\n        let _newRenderBegin = _newInViewBegin;\n        // æ–°çš„æ¸²æŸ“ç»“æŸ\n        let _newRenderEnd = reactiveData.inViewEnd;\n\n        // è®¡ç®—buffer\n        _newRenderBegin = Math.max(0, _newRenderBegin - reactiveData.bufferTop);\n        _newRenderEnd = Math.min(\n          _newRenderEnd + reactiveData.bufferBottom,\n          props.list.length - 1,\n        );\n\n        // æ§åˆ¶å±‚æ¸²æŸ“ï¼Œç­‰äºè¯´è¦è¦†ç›–æ‰buffer\n        if (props?.renderControl) {\n          const { begin, end } = props.renderControl(\n            _newInViewBegin,\n            reactiveData.inViewEnd,\n          );\n          _newRenderBegin = begin;\n          _newRenderEnd = end;\n        }\n\n        // update render begin\n        reactiveData.renderBegin = _newRenderBegin;\n        // update render end\n        reactiveData.renderEnd = _newRenderEnd;\n        // update virtualSize, diff range size\n        if (_newRenderBegin > _oldRenderBegin) {\n          reactiveData.virtualSize += getRangeSize(\n            _newRenderBegin,\n            _oldRenderBegin,\n          );\n        } else {\n          reactiveData.virtualSize -= getRangeSize(\n            _newRenderBegin,\n            _oldRenderBegin,\n          );\n        }\n        // update render list\n        renderList.value = props.list.slice(\n          reactiveData.renderBegin,\n          reactiveData.renderEnd + 1,\n        );\n      }\n    },\n    {\n      immediate: true,\n    },\n  );\n\n  watch(\n    () => props.list.length,\n    () => {\n      // å¦‚æœæ•°æ®ä¸ºç©ºï¼Œé‚£ä¹ˆå°±é‡ç½®\n      if (props.list.length <= 0) {\n        reset();\n        return;\n      }\n\n      // [require] å› ä¸ºlisté•¿åº¦å˜åŒ–ï¼Œæ‰€ä»¥æ€»é«˜åº¦æœ‰å˜åŒ–\n      calcListTotalSize();\n      // [require] å› ä¸ºlisté•¿åº¦å˜åŒ–ï¼Œæ‰€ä»¥é‡æ–°è®¡ç®—èµ·å§‹ç»“æŸä½ç½®\n      updateRange(reactiveData.inViewBegin);\n      // [require] å¦‚æœé¡¶éƒ¨åˆ—è¡¨æ•°æ®å‘ç”Ÿå˜æ›´éœ€è¦æ›´æ­£é¡¶éƒ¨é«˜åº¦\n      updateTotalVirtualSize();\n      // [require] åˆ—è¡¨é•¿åº¦åˆ‡å†…å®¹å‘ç”Ÿå˜åŒ–ï¼Œå¦‚æœèµ·å§‹ä½ç½®æ²¡å˜ï¼Œåˆ™éœ€è¦å¼ºåˆ¶æ›´æ–°ä¸€ä¸‹é¡µé¢\n      forceUpdate();\n    },\n    {\n      immediate: true,\n    },\n  );\n\n  return {\n    props,\n\n    renderList,\n\n    clientRefEl,\n    listRefEl,\n    headerRefEl,\n    footerRefEl,\n    stickyHeaderRefEl,\n    stickyFooterRefEl,\n\n    reactiveData,\n    slotSize,\n    sizesMap,\n\n    resizeObserver,\n\n    getOffset,\n    reset,\n    scrollToIndex,\n    scrollIntoView,\n    scrollToTop,\n    scrollToBottom,\n    scrollToOffset,\n    getItemSize,\n    deleteItemSize,\n    // expose only\n    deletedList2Top,\n    addedList2Top,\n    getItemPosByIndex,\n    forceUpdate,\n  };\n}\nconst VirtList = defineComponent({\n  name: 'VirtList',\n  props: {\n    list: {\n      type: Array<any>,\n      default: () => [],\n    },\n    // æ•°æ®key\n    itemKey: {\n      type: [String, Number],\n      required: true,\n    },\n    // æœ€å°å°ºå¯¸\n    minSize: {\n      type: Number,\n      default: 20,\n      required: true,\n    },\n    renderControl: {\n      type: Function,\n      default: undefined,\n    },\n    fixed: {\n      type: Boolean,\n      default: false,\n    },\n    buffer: {\n      type: Number,\n      default: 0,\n    },\n    bufferTop: {\n      type: Number,\n      default: 0,\n    },\n    bufferBottom: {\n      type: Number,\n      default: 0,\n    },\n    // æ»šåŠ¨è·ç¦»é˜ˆå€¼\n    scrollDistance: {\n      type: Number,\n      default: 0,\n    },\n    // æ˜¯å¦ä¸ºæ°´å¹³ç§»åŠ¨\n    horizontal: {\n      type: Boolean,\n      default: false,\n    },\n    // èµ·å§‹ä¸‹æ ‡\n    start: {\n      type: Number,\n      default: 0,\n    },\n    // èµ·å§‹åç§»é‡\n    offset: {\n      type: Number,\n      default: 0,\n    },\n    listStyle: {\n      type: String,\n      default: '',\n    },\n    listClass: {\n      type: String,\n      default: '',\n    },\n    itemStyle: {\n      type: String,\n      default: '',\n    },\n    itemClass: {\n      type: String,\n      default: '',\n    },\n    headerClass: {\n      type: String,\n      default: '',\n    },\n    headerStyle: {\n      type: String,\n      default: '',\n    },\n    footerClass: {\n      type: String,\n      default: '',\n    },\n    footerStyle: {\n      type: String,\n      default: '',\n    },\n    stickyHeaderClass: {\n      type: String,\n      default: '',\n    },\n    stickyHeaderStyle: {\n      type: String,\n      default: '',\n    },\n    stickyFooterClass: {\n      type: String,\n      default: '',\n    },\n    stickyFooterStyle: {\n      type: String,\n      default: '',\n    },\n  },\n  setup(props: any, context: SetupContext) {\n    const emitFunction: EmitFunction<any> = {\n      scroll: (evt: Event) => {\n        context.emit('scroll', evt);\n      },\n      toTop: (firstItem: any) => {\n        context.emit('toTop', firstItem);\n      },\n      toBottom: (lastItem: any) => {\n        context.emit('toBottom', lastItem);\n      },\n      itemResize: (id: string, newSize: number) => {\n        context.emit('itemResize', id, newSize);\n      },\n    };\n\n    return useVirtList(props, emitFunction);\n  },\n  render() {\n    const { renderList, reactiveData, resizeObserver } = this;\n    const {\n      itemKey,\n      horizontal,\n      listStyle,\n      listClass,\n      itemStyle,\n      itemClass,\n      headerClass,\n      headerStyle,\n      footerClass,\n      footerStyle,\n      stickyHeaderClass,\n      stickyHeaderStyle,\n      stickyFooterClass,\n      stickyFooterStyle,\n    } = this.props;\n\n    const renderStickyHeaderSlot = (): VNode | null => {\n      return this.$slots.stickyHeader\n        ? h(\n            'div',\n            polyfillAttr(\n              {\n                key: 'slot-sticky-header',\n                class: stickyHeaderClass,\n                style: `position: sticky; z-index: 10; ${\n                  horizontal ? 'left: 0' : 'top: 0;'\n                } ${stickyHeaderStyle}`,\n                ref: 'stickyHeaderRefEl',\n              },\n              {\n                'data-id': 'stickyHeader',\n              },\n            ),\n            [polyfillSlot(this.$slots.stickyHeader)],\n          )\n        : null;\n    };\n\n    const renderStickyFooterSlot = (): VNode | null => {\n      return this.$slots.stickyFooter\n        ? h(\n            'div',\n            polyfillAttr(\n              {\n                key: 'slot-sticky-footer',\n                class: stickyFooterClass,\n                style: `position: sticky; z-index: 10; ${\n                  horizontal ? 'right: 0' : 'bottom: 0;'\n                } ${stickyFooterStyle}`,\n                ref: 'stickyFooterRefEl',\n              },\n              {\n                'data-id': 'stickyFooter',\n              },\n            ),\n            [polyfillSlot(this.$slots.stickyFooter)],\n          )\n        : null;\n    };\n\n    const renderHeaderSlot = (): VNode | null => {\n      return this.$slots.header\n        ? h(\n            'div',\n            polyfillAttr(\n              {\n                key: 'slot-header',\n                class: headerClass,\n                style: headerStyle,\n                ref: 'headerRefEl',\n              },\n              {\n                'data-id': 'header',\n              },\n            ),\n            [polyfillSlot(this.$slots.header)],\n          )\n        : null;\n    };\n\n    const renderFooterSlot = (): VNode | null => {\n      return this.$slots.footer\n        ? h(\n            'div',\n            polyfillAttr(\n              {\n                key: 'slot-footer',\n                class: footerClass,\n                style: footerStyle,\n                ref: 'footerRefEl',\n              },\n              {\n                'data-id': 'footer',\n              },\n            ),\n            [polyfillSlot(this.$slots.footer)],\n          )\n        : null;\n    };\n\n    const { listTotalSize, virtualSize, renderBegin } = reactiveData;\n\n    const renderMainList = (): VNode | null => {\n      const mainList = [];\n      for (let index = 0; index < renderList.length; index += 1) {\n        const currentItem = renderList[index];\n        mainList.push(\n          h(\n            ObserverItem,\n            polyfillAttr(\n              {\n                key: currentItem[itemKey],\n                class: itemClass,\n                style: itemStyle,\n              },\n              {\n                id: currentItem[itemKey],\n                resizeObserver: resizeObserver,\n              },\n            ),\n            polyfillChildren([\n              isVue2\n                ? (this as any).$scopedSlots?.default?.({\n                    itemData: currentItem,\n                    index: renderBegin + index,\n                  })\n                : (this as any).$slots.default?.({\n                    itemData: currentItem,\n                    index: renderBegin + index,\n                  }),\n            ]) as VNodeChild[],\n          ),\n        );\n      }\n\n      const dynamicListStyle = horizontal\n        ? `will-change: width; min-width: ${listTotalSize}px; display: flex; ${listStyle}`\n        : `will-change: height; min-height: ${listTotalSize}px; ${listStyle}`;\n\n      return h(\n        'div',\n        {\n          ref: 'listRefEl',\n          class: listClass,\n          style: dynamicListStyle,\n        },\n        [\n          h('div', {\n            style: horizontal\n              ? `width: ${virtualSize}px; will-change: width;`\n              : `height: ${virtualSize}px; will-change: height;`,\n          }),\n          mainList,\n        ],\n      );\n    };\n\n    // const renderVirtualScrollbar = () => {\n    //   return <div style={`float: left; height: ${listTotalSize}px`}></div>; // è™šæ‹Ÿæ»šåŠ¨æ¡\n    // };\n\n    return h(\n      'div',\n      polyfillAttr(\n        {\n          ref: 'clientRefEl',\n          class: 'virt-list__client',\n          style: `width: 100%; height: 100%; overflow: overlay;`,\n        },\n        {\n          'data-id': 'client',\n        },\n      ),\n      polyfillChildren([\n        renderStickyHeaderSlot(),\n        renderHeaderSlot(),\n        renderMainList(),\n        renderFooterSlot(),\n        renderStickyFooterSlot(),\n      ]) as VNodeChild[],\n    );\n  },\n});\n\nexport { VirtList, useVirtList };\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport {\n  defineComponent,\n  h,\n  isVue2,\n  onBeforeUnmount,\n  onBeforeUpdate,\n  onMounted,\n  onUpdated,\n  ref,\n  shallowReactive,\n  watch,\n  type ShallowReactive,\n  type VNode,\n} from 'vue-demi';\nimport { ObserverItem } from './ObserverItem';\nimport { polyfillAttr, polyfillChildren, polyfillSlot } from './util';\nimport type { NormalEmitFunction, SlotSize, RealListProps } from './type';\n\nconst defaultProps = {\n  itemKey: 'id',\n  miniSize: 40,\n  list: [],\n  scrollDistance: 100,\n  headerClass: '',\n  headerStyle: '',\n  footerClass: '',\n  footerStyle: '',\n  stickyHeaderClass: '',\n  stickyHeaderStyle: '',\n  stickyFooterClass: '',\n  stickyFooterStyle: '',\n};\n\nconst useRealList = <T extends Record<string, any>>(\n  userProps: ShallowReactive<RealListProps<T>>,\n  emitFunction?: NormalEmitFunction<T>,\n) => {\n  const props = new Proxy(userProps, {\n    get(target, key) {\n      return Reflect.get(target, key) ?? Reflect.get(defaultProps, key);\n    },\n  }) as Required<RealListProps<T>>;\n\n  const clientRefEl = ref<HTMLElement | null>(null);\n  const listRefEl = ref<HTMLElement | null>(null);\n  const headerRefEl = ref<HTMLElement | null>(null);\n  const footerRefEl = ref<HTMLElement | null>(null);\n  const stickyHeaderRefEl = ref<HTMLElement | null>(null);\n  const stickyFooterRefEl = ref<HTMLElement | null>(null);\n\n  const sizesMap = new Map();\n  const offsetMap = new Map();\n\n  // æ’æ§½çš„ç›¸å…³å°ºå¯¸æ•°æ®\n  const slotSize: ShallowReactive<SlotSize> = shallowReactive({\n    clientSize: 0,\n    headerSize: 0,\n    footerSize: 0,\n    stickyHeaderSize: 0,\n    stickyFooterSize: 0,\n  });\n  const reactiveData = shallowReactive({\n    listTotalSize: 0, // ä¸åŒ…å«æ’æ§½çš„é«˜åº¦\n    begin: '',\n    end: '',\n  });\n\n  // æ»šåŠ¨åˆ°é¡¶éƒ¨å’Œåº•éƒ¨çš„æ ‡å¿—ä½\n  const isScrollTop = ref(false);\n  const isScrollBottom = ref(false);\n\n  const isUpdating = ref(false);\n\n  const calcListTotalSize = () => {\n    // è®¡ç®—å½“å‰æ‰€æœ‰åˆ—è¡¨çš„é«˜åº¦\n    const { itemKey } = props;\n    let re = 0;\n    for (let i = 0; i <= props.list.length - 1; i += 1) {\n      re += getItemSize(props.list[i]?.[itemKey]);\n    }\n    reactiveData.listTotalSize = re;\n  };\n\n  const getItemSize = (itemKey: string) =>\n    sizesMap.get(String(itemKey)) ?? props.minSize;\n\n  const setItemSize = (itemKey: string, size: number) => {\n    sizesMap.set(String(itemKey), size);\n  };\n\n  // è·å–å½“å‰çš„å®¹å™¨çš„æ»šåŠ¨åç§»é‡\n  const getScrollOffset = () =>\n    clientRefEl.value ? clientRefEl.value.scrollTop : 0;\n\n  let resizeObserver: ResizeObserver | undefined = undefined;\n  if (typeof ResizeObserver !== 'undefined') {\n    resizeObserver = new ResizeObserver((entries) => {\n      // å°ºå¯¸å˜åŒ–çš„æ—¶å€™å…¶å®éœ€è¦å»æ›´æ–°å…ƒç´ çš„sizeMapå’ŒoffsetMap\n      let diff = 0;\n      for (const entry of entries) {\n        const { id } = (entry.target as HTMLElement).dataset;\n\n        if (id) {\n          const prevSize = getItemSize(id);\n          const currentSize = entry.contentBoxSize[0].blockSize;\n\n          if (id === 'client') {\n            slotSize.clientSize = currentSize;\n          } else if (id === 'header') {\n            slotSize.headerSize = currentSize;\n          } else if (id === 'footer') {\n            slotSize.footerSize = currentSize;\n          } else if (id === 'stickyHeader') {\n            slotSize.stickyHeaderSize = currentSize;\n          } else if (id === 'stickyFooter') {\n            slotSize.stickyFooterSize = currentSize;\n          } else if (prevSize !== currentSize) {\n            setItemSize(id, currentSize);\n            diff += currentSize - prevSize;\n\n            emitFunction?.itemResize?.(id, currentSize);\n          }\n        }\n      }\n\n      // æ›´æ–°åˆ—è¡¨çš„æ•´ä½“å°ºå¯¸\n      reactiveData.listTotalSize += diff;\n\n      // çº æ­£æ‰€æœ‰åˆ—è¡¨çš„è¯¯å·®ï¼Œé˜²æ­¢æœ‰çš„åˆ—è¡¨æ²¡æœ‰æ›´æ–°diff\n      calcListTotalSize();\n      updateOffset();\n\n      // åªæœ‰åˆ—è¡¨æ›´æ–°æ—¶å€™çš„å°ºå¯¸å˜åŒ–æ‰éœ€è¦ä¸»åŠ¨ä¿®æ­£ä½ç½®\n      if (isUpdating.value) {\n        if (isScrollTop.value) scrollIntoPosition('forward');\n        if (isScrollBottom.value) scrollIntoPosition('backward');\n        return;\n      }\n\n      // å…ƒç´ å°ºå¯¸å˜åŒ–çš„æ—¶å€™ï¼Œéœ€è¦åˆ¤æ–­æ˜¯å¦è§¦åº•æˆ–è€…è§¦é¡¶\n      const currentScrollOffset = getScrollOffset();\n      checkScrollStatus(currentScrollOffset);\n    });\n  }\n\n  const getItemOffset = (itemKey: string) =>\n    offsetMap.get(String(itemKey)) ?? -1;\n\n  const setItemOffset = (itemKey: string, size: number) => {\n    offsetMap.set(String(itemKey), size);\n  };\n\n  const updateOffset = () => {\n    const { itemKey } = props;\n    offsetMap.clear();\n    let offset = 0;\n    for (let i = 0; i < props.list.length; i += 1) {\n      setItemOffset(props.list[i]?.[itemKey], offset);\n      offset += getItemSize(props.list[i]?.[itemKey]);\n    }\n  };\n\n  const getSlotSize = () =>\n    slotSize.headerSize + slotSize.stickyFooterSize + slotSize.stickyHeaderSize;\n\n  const debounce = (func: () => void, wait: number) => {\n    let timeout: NodeJS.Timeout;\n\n    return function () {\n      clearTimeout(timeout);\n      timeout = setTimeout(() => func(), wait);\n    };\n  };\n\n  // å½“å‰å¯è§†åŒºåŸŸå†…çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„key\n  let currentKey = '';\n\n  const updateFirstKey = debounce(() => {\n    currentKey = getCurrentFirstItem();\n    emitFunction?.updateCurrent?.(currentKey);\n    // ctx.emit('updateCurrent', currentKey);\n  }, 200);\n\n  /**\n   * @description åˆ¤æ–­å½“å‰æ»šåŠ¨çš„çŠ¶æ€ï¼Œåˆ¤æ–­æ˜¯å¦è§¦é¡¶æˆ–è€…è§¦åº•\n   * @param currentScrollOffset å½“å‰åˆ—è¡¨æ»šåŠ¨çš„åç§»é‡\n   */\n  const checkScrollStatus = (currentScrollOffset: number) => {\n    if (props.list.length <= 0) return;\n    if (currentScrollOffset <= props.scrollDistance) {\n      reactiveData.begin = props.list[0][props.itemKey];\n      if (props.list.length > props.pageSize) {\n        reactiveData.end =\n          props.list[props.list.length - props.pageSize - 1][props.itemKey];\n      } else {\n        reactiveData.end = props.list[props.list.length - 1][props.itemKey];\n      }\n      emitFunction?.toTop?.(props.list[0]);\n      // ctx.emit('toTop', props.list[0]);\n      isScrollBottom.value = false;\n      isScrollTop.value = true;\n    }\n    // å†…å®¹æ€»é«˜åº¦ = åˆ—è¡¨æ€»é«˜åº¦ + å¤´éƒ¨æ’æ§½é«˜åº¦ + å°¾éƒ¨æ’æ§½é«˜åº¦\n    // reactiveData.listTotalSize + slotSize.headerSize + slotSize.footerSize\n    // æ»šåŠ¨é«˜åº¦ + å¯è§†åŒºåŸŸé«˜åº¦ + é˜ˆå€¼ >= å†…å®¹æ€»é«˜åº¦\n    if (\n      currentScrollOffset + props.scrollDistance >=\n      reactiveData.listTotalSize + getSlotSize() - slotSize.clientSize\n    ) {\n      reactiveData.end = props.list[props.list.length - 1][props.itemKey];\n      if (props.list.length > props.pageSize) {\n        reactiveData.begin = props.list[props.pageSize][props.itemKey];\n      } else {\n        reactiveData.begin = props.list[0][props.itemKey];\n      }\n      emitFunction?.toBottom?.(props.list[props.list.length - 1]);\n      // ctx.emit('toBottom', props.list[props.list.length - 1]);\n      isScrollBottom.value = true;\n      isScrollTop.value = false;\n    }\n  };\n\n  const onScroll = (evt: Event) => {\n    emitFunction?.scroll?.(evt);\n    // ctx.emit('scroll', evt);\n    if (props.list.length <= 0) return;\n    const currentScrollOffset = getScrollOffset();\n    if (isUpdating.value) {\n      const currentStartOffset = getItemOffset(reactiveData.begin);\n      if (currentScrollOffset < currentStartOffset) {\n        scrollToOffset(currentStartOffset);\n      }\n      return;\n    }\n\n    updateFirstKey();\n    checkScrollStatus(currentScrollOffset);\n  };\n\n  const scrollToOffset = (offset: number) => {\n    const directionKey = 'scrollTop';\n    if (clientRefEl.value) clientRefEl.value[directionKey] = offset;\n  };\n\n  /**\n   * @description å°†æŒ‡å®šä¸‹æ ‡çš„å…ƒç´ æ»šåŠ¨åˆ°å¯è§†åŒºåŸŸ\n   * @param index ç›®æ ‡å…ƒç´ ä¸‹æ ‡\n   */\n  const scrollIntoView = (index: number) => {\n    // æ»šåŠ¨æŒ‡å®šå…ƒç´ åˆ°å¯è§†åŒºåŸŸ\n    const targetMin = getItemOffset(props.list[index]?.[props.itemKey]);\n\n    const scrollTargetToView = async (\n      targetMin: number,\n      resolve: (val?: unknown) => void,\n    ) => {\n      // å¦‚æœæ²¡æœ‰æ‹¿åˆ°ç›®æ ‡å…ƒç´ çš„ä½ç½®ï¼Œé‚£ä¹ˆå°±ç­‰ä¸€ä¸‹å†å»æ‹¿\n      if (targetMin === -1) {\n        setTimeout(() => {\n          const offset = getItemOffset(props.list[index]?.[props.itemKey]);\n          scrollTargetToView(offset, resolve);\n        }, 3);\n        return;\n      }\n\n      const currentSize = getItemSize(props.list[index]?.[props.itemKey]);\n      const targetMax = targetMin + currentSize;\n\n      const offsetMin = getScrollOffset();\n      const offsetMax = getScrollOffset() + slotSize.clientSize;\n      if (\n        targetMin < offsetMin &&\n        offsetMin < targetMax &&\n        currentSize < slotSize.clientSize\n      ) {\n        // å¦‚æœç›®æ ‡å…ƒç´ ä¸Šæ–¹çœ‹ä¸åˆ°ï¼Œåº•éƒ¨çœ‹å¾—åˆ°ï¼Œé‚£ä¹ˆæ»šåŠ¨åˆ°é¡¶éƒ¨éƒ¨çœ‹å¾—åˆ°å°±è¡Œäº†\n        scrollToOffset(targetMin + slotSize.headerSize);\n        resolve();\n        return;\n      }\n      if (\n        targetMin + slotSize.stickyHeaderSize < offsetMax &&\n        offsetMax < targetMax + slotSize.stickyHeaderSize &&\n        currentSize < slotSize.clientSize\n      ) {\n        // å¦‚æœç›®æ ‡å…ƒç´ ä¸Šæ–¹çœ‹å¾—åˆ°ï¼Œåº•éƒ¨çœ‹ä¸åˆ°ï¼Œé‚£ä¹ˆæ»šåŠ¨åˆ°åº•éƒ¨çœ‹å¾—åˆ°å°±è¡Œäº†\n        scrollToOffset(\n          targetMax - slotSize.clientSize + slotSize.stickyHeaderSize,\n        );\n        resolve();\n        return;\n      }\n      // å±å¹•ä¸‹æ–¹\n      if (targetMin + slotSize.stickyHeaderSize >= offsetMax) {\n        await scrollToIndex(index);\n        resolve();\n        return;\n      }\n\n      // å±å¹•ä¸Šæ–¹\n      if (targetMax <= offsetMin) {\n        await scrollToIndex(index);\n      }\n      resolve();\n\n      // åœ¨ä¸­é—´å°±ä¸åŠ¨äº†\n    };\n    return new Promise((resolve) => {\n      scrollTargetToView(targetMin, resolve);\n    });\n  };\n\n  const getOffsetByIndex = (index: number) => {\n    const key = props.list[index]?.[props.itemKey];\n    return getItemOffset(key);\n  };\n\n  /**\n   * @description è·å–å½“å‰å¯è§†åŒºåŸŸå†…çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„key\n   * @returns å½“å‰å¯è§†åŒºåŸŸçš„ä¸€ä¸ªå…ƒç´ çš„key\n   */\n  const getCurrentFirstItem = () => {\n    let currentKey = '';\n    const currentScrollOffset = getScrollOffset();\n    const preDistance =\n      currentScrollOffset + slotSize.stickyHeaderSize - slotSize.headerSize;\n    const distance = preDistance < 0 ? 0 : preDistance;\n    for (const [key, value] of offsetMap) {\n      if (value <= distance && value + getItemSize(key) > currentScrollOffset) {\n        currentKey = key;\n        break;\n      }\n    }\n    return currentKey;\n  };\n\n  /**\n   * @description å°†æŒ‡å®šä¸‹æ ‡çš„å…ƒç´ æ»šåŠ¨åˆ°å¯è§†åŒºåŸŸç¬¬ä¸€ä¸ªä½ç½®\n   * @param index ç›®æ ‡å…ƒç´ ä¸‹æ ‡\n   */\n  const scrollToIndex = (index: number) => {\n    // æ»šåŠ¨åˆ°æŒ‡å®šå…ƒç´ \n    if (index < 0) return;\n    // å¦‚æœè¦å»çš„ä½ç½®å¤§äºé•¿åº¦ï¼Œé‚£ä¹ˆå°±ç›´æ¥è°ƒç”¨å»åº•éƒ¨çš„æ–¹æ³•\n    if (index >= props.list.length - 1) {\n      scrollToBottom();\n      return;\n    }\n\n    const offset = getItemOffset(props.list[index]?.[props.itemKey]);\n    const scrollToTargetOffset = (\n      targetOffset: number,\n      resolve: (val?: unknown) => void,\n    ) => {\n      if (targetOffset === -1) {\n        setTimeout(() => {\n          const offset = getItemOffset(props.list[index]?.[props.itemKey]);\n          scrollToTargetOffset(offset, resolve);\n        }, 3);\n        return;\n      }\n      scrollToOffset(targetOffset + slotSize.headerSize);\n      resolve();\n    };\n    return new Promise((resolve) => {\n      scrollToTargetOffset(offset, resolve);\n    });\n  };\n\n  const scrollToBottom = () => {\n    const bottomOffset =\n      reactiveData.listTotalSize + slotSize.headerSize + slotSize.footerSize;\n    scrollToOffset(bottomOffset);\n  };\n  let preScrollOffset = 0;\n\n  const scrollIntoPosition = (direction: 'forward' | 'backward') => {\n    if (!clientRefEl.value) return;\n    if (direction === 'forward') {\n      scrollToOffset(preScrollOffset + getItemOffset(reactiveData.begin));\n    } else {\n      scrollToOffset(preScrollOffset);\n    }\n  };\n\n  const reset = () => {\n    // é‡ç½®æ‰€æœ‰çš„æ•°æ®\n    reactiveData.listTotalSize = 0;\n\n    reactiveData.begin = '';\n    reactiveData.end = '';\n\n    sizesMap.clear();\n    offsetMap.clear();\n  };\n\n  watch(\n    () => props.list,\n    () => {\n      // åœ¨æ•°æ®å˜åŒ–çš„æ—¶å€™æ‰å»å°†æ›´æ–°çŠ¶æ€ä½è®¾ç½®ä¸ºtrue\n      // é˜²æ­¢å¤šæ¬¡è§¦å‘åˆ†é¡µæ“ä½œ\n      isUpdating.value = true;\n    },\n    {\n      deep: false,\n    },\n  );\n\n  onBeforeUpdate(() => {\n    // å·²ç»æ‹¿åˆ°äº†æ–°çš„åˆ—è¡¨\n    if (isScrollTop.value) {\n      preScrollOffset = getScrollOffset();\n    }\n    if (isScrollBottom.value) {\n      preScrollOffset =\n        getScrollOffset() - offsetMap.get(String(reactiveData.begin));\n    }\n  });\n\n  onUpdated(() => {\n    // è¿™ä¸ªæ—¶å€™å·²ç»æ›´æ–°å®Œæˆäº† ä½†æ˜¯æ»šåŠ¨ä¼šè§¦å‘é˜ˆå€¼çš„åˆ¤æ–­ï¼Œæ‰€ä»¥éœ€è¦å»¶è¿Ÿä¸€ä¸‹\n    setTimeout(() => {\n      isUpdating.value = false;\n    }, 10);\n  });\n\n  onMounted(() => {\n    if (clientRefEl.value) {\n      clientRefEl.value.addEventListener('scroll', onScroll);\n      resizeObserver?.observe(clientRefEl.value);\n    }\n\n    if (stickyHeaderRefEl.value) {\n      resizeObserver?.observe(stickyHeaderRefEl.value);\n    }\n    if (stickyFooterRefEl.value) {\n      resizeObserver?.observe(stickyFooterRefEl.value);\n    }\n    if (headerRefEl.value) {\n      resizeObserver?.observe(headerRefEl.value);\n    }\n    if (footerRefEl.value) {\n      resizeObserver?.observe(footerRefEl.value);\n    }\n  });\n\n  onBeforeUnmount(() => {\n    if (clientRefEl.value) {\n      clientRefEl.value.removeEventListener('scroll', onScroll);\n      resizeObserver?.unobserve(clientRefEl.value);\n      slotSize.clientSize = 0;\n    }\n\n    if (stickyHeaderRefEl.value) {\n      resizeObserver?.unobserve(stickyHeaderRefEl.value);\n      slotSize.stickyHeaderSize = 0;\n    }\n    if (stickyFooterRefEl.value) {\n      resizeObserver?.unobserve(stickyFooterRefEl.value);\n      slotSize.stickyFooterSize = 0;\n    }\n    if (headerRefEl.value) {\n      resizeObserver?.unobserve(headerRefEl.value);\n      slotSize.headerSize = 0;\n    }\n    if (footerRefEl.value) {\n      resizeObserver?.unobserve(footerRefEl.value);\n      slotSize.footerSize = 0;\n    }\n  });\n\n  return {\n    props,\n    resizeObserver,\n    sizesMap,\n    slotSize,\n\n    clientRefEl,\n    listRefEl,\n    headerRefEl,\n    footerRefEl,\n    stickyHeaderRefEl,\n    stickyFooterRefEl,\n\n    scrollIntoView,\n    scrollToIndex,\n    reset,\n    getItemOffset,\n    getCurrentFirstItem,\n    getOffsetByIndex,\n    scrollToOffset,\n  };\n};\n\nconst RealList = defineComponent({\n  name: 'RealList',\n  props: {\n    itemKey: {\n      type: [String, Number],\n      default: 'id',\n    },\n    list: {\n      type: Array<any>,\n      default: () => [],\n    },\n    minSize: {\n      type: Number,\n      default: 40,\n    },\n    pageSize: {\n      type: Number,\n      default: 30,\n    },\n    scrollDistance: {\n      type: Number,\n      default: 100,\n    },\n    headerClass: {\n      type: String,\n      default: '',\n    },\n    headerStyle: {\n      type: String,\n      default: '',\n    },\n    footerClass: {\n      type: String,\n      default: '',\n    },\n    footerStyle: {\n      type: String,\n      default: '',\n    },\n    stickyHeaderClass: {\n      type: String,\n      default: '',\n    },\n    stickyHeaderStyle: {\n      type: String,\n      default: '',\n    },\n    stickyFooterClass: {\n      type: String,\n      default: '',\n    },\n    stickyFooterStyle: {\n      type: String,\n      default: '',\n    },\n  },\n  setup(props, ctx) {\n    const emitFunction: NormalEmitFunction<any> = {\n      scroll: (evt: Event) => {\n        ctx.emit('scroll', evt);\n      },\n      toTop: (firstItem: any) => {\n        ctx.emit('toTop', firstItem);\n      },\n      toBottom: (lastItem: any) => {\n        ctx.emit('toBottom', lastItem);\n      },\n      itemResize: (id: string, newSize: number) => {\n        ctx.emit('itemResize', id, newSize);\n      },\n      updateCurrent: (key: string | number) => {\n        ctx.emit('updateCurrent', key);\n      },\n    };\n\n    return useRealList(props, emitFunction);\n  },\n  render() {\n    const { props, resizeObserver } = this;\n\n    const {\n      itemKey,\n      headerClass,\n      headerStyle,\n      footerClass,\n      footerStyle,\n      stickyHeaderClass,\n      stickyHeaderStyle,\n      stickyFooterClass,\n      stickyFooterStyle,\n    } = props as RealListProps<any>;\n\n    const { header, footer, stickyHeader, stickyFooter } = this.$slots;\n\n    const renderStickyHeaderSlot = (): VNode | null =>\n      stickyHeader\n        ? h(\n            'div',\n            polyfillAttr(\n              {\n                key: 'slot-sticky-header',\n                class: stickyHeaderClass,\n                style: `position: sticky; z-index: 10; 'top: 0; ${stickyHeaderStyle}`,\n                ref: 'stickyHeaderRefEl',\n              },\n              {\n                'data-id': 'stickyHeader',\n              },\n            ),\n            [polyfillSlot(stickyHeader)],\n          )\n        : null;\n\n    const renderStickyFooterSlot = (): VNode | null =>\n      stickyFooter\n        ? h(\n            'div',\n            polyfillAttr(\n              {\n                key: 'slot-sticky-footer',\n                class: stickyFooterClass,\n                style: `position: sticky; z-index: 10; bottom: 0; ${stickyFooterStyle}`,\n                ref: 'stickyFooterRefEl',\n              },\n              {\n                'data-id': 'stickyFooter',\n              },\n            ),\n            [polyfillSlot(stickyFooter)],\n          )\n        : null;\n\n    const renderHeaderSlot = (): VNode | null =>\n      header\n        ? h(\n            'div',\n            polyfillAttr(\n              {\n                key: 'slot-header',\n                class: headerClass,\n                style: headerStyle,\n                ref: 'headerRefEl',\n              },\n              {\n                'data-id': 'header',\n              },\n            ),\n            [polyfillSlot(header)],\n          )\n        : null;\n\n    const renderFooterSlot = (): VNode | null =>\n      footer\n        ? h(\n            'div',\n            polyfillAttr(\n              {\n                key: 'slot-footer',\n                class: footerClass,\n                style: footerStyle,\n                ref: 'footerRefEl',\n              },\n              {\n                'data-id': 'footer',\n              },\n            ),\n            [polyfillSlot(footer)],\n          )\n        : null;\n\n    const renderMainList = (): VNode | null => {\n      const mainList = [];\n      for (let i = 0; i < props.list.length; i++) {\n        const currentItem = props.list[i];\n        mainList.push(\n          h(\n            ObserverItem,\n            polyfillAttr(\n              {\n                key: currentItem[itemKey],\n              },\n              {\n                id: currentItem[itemKey],\n                resizeObserver: resizeObserver,\n              },\n            ),\n            polyfillChildren([\n              isVue2\n                ? (this as any).$scopedSlots?.default?.({\n                    itemData: currentItem,\n                  })\n                : (this.$slots as any).default?.({\n                    itemData: currentItem,\n                  }),\n            ]),\n          ),\n        );\n      }\n      return h(\n        'div',\n        {\n          ref: 'listRefEl',\n        },\n        [mainList],\n      );\n    };\n\n    return h(\n      'div',\n      polyfillAttr(\n        {\n          ref: 'clientRefEl',\n          style: `width: 100%; height: 100%; overflow: overlay;`,\n        },\n        {\n          'data-id': 'client',\n        },\n      ),\n      polyfillChildren([\n        renderStickyHeaderSlot(),\n        renderHeaderSlot(),\n        renderMainList(),\n        renderFooterSlot(),\n        renderStickyFooterSlot(),\n      ]),\n    );\n  },\n});\n\nexport { RealList };\n"],"names":["useObserverItem","props","itemRefEl","ref","onMounted","resizeObserver","value","observe","onBeforeUnmount","unobserve","ObserverItem","defineComponent","name","type","ResizeObserver","require","id","String","Number","setup","render","h","polyfillAttr","polyfillSlot","$slots","default","defaultProps","fixed","buffer","bufferTop","bufferBottom","scrollDistance","horizontal","fixSelection","start","offset","listStyle","listClass","itemStyle","itemClass","headerClass","headerStyle","footerClass","footerStyle","stickyHeaderClass","stickyHeaderStyle","stickyFooterClass","stickyFooterStyle","useVirtList","userProps","emitFunction","Proxy","get","target","key","Reflect","clientRefEl","listRefEl","headerRefEl","footerRefEl","stickyHeaderRefEl","stickyFooterRefEl","sizesMap","Map","renderKey","direction","fixOffset","forceFixOffset","abortFixOffset","slotSize","shallowReactive","clientSize","headerSize","footerSize","stickyHeaderSize","stickyFooterSize","reactiveData","views","listTotalSize","virtualSize","inViewBegin","inViewEnd","renderBegin","renderEnd","getOffset","directionKey","getSlotSize","getTotalSize","getItemSize","itemKey","minSize","setItemSize","size","set","deleteItemSize","delete","getItemPosByIndex","index","top","current","bottom","topReduce","i","currentSize","list","scrollToOffset","scrollToIndex","console","log","length","scrollToBottom","lastOffset","recursion","setTimeout","scrollIntoView","targetMin","targetMax","offsetMin","offsetMax","scrollToTop","Math","abs","round","selection","window","getSelection","anchorNode","anchorOffset","focusNode","focusOffset","requestAnimationFrame","setBaseAndExtent","updateRange","isVue2","min","calcRange","offsetWithNoHeader","offsetReduce","getVirtualSize2beginInView","onScroll","evt","scroll","toTop","toBottom","calcViews","newViews","ceil","onClientResize","calcListTotalSize","re","reset","clear","deletedList2Top","deletedList","deletedListSize","forEach","item","updateTotalVirtualSize","addedList2Top","addedList","addedListSize","forceUpdate","undefined","entries","diff","entry","dataset","oldSize","newSize","borderBoxSize","contentBoxSize","Array","isArray","inlineSize","blockSize","contentRect","width","height","itemResize","currentFirst","onBeforeMount","addEventListener","removeEventListener","getRangeSize","range1","range2","end","max","renderList","shallowRef","watch","newVal","oldVal","_newInViewBegin","_oldRenderBegin","_newRenderBegin","_newRenderEnd","renderControl","begin","slice","immediate","VirtList","required","Function","Boolean","context","emit","firstItem","lastItem","renderStickyHeaderSlot","stickyHeader","class","style","renderStickyFooterSlot","stickyFooter","renderHeaderSlot","header","renderFooterSlot","footer","renderMainList","mainList","currentItem","push","polyfillChildren","$scopedSlots","itemData","dynamicListStyle","miniSize","useRealList","offsetMap","isScrollTop","isScrollBottom","isUpdating","getScrollOffset","scrollTop","prevSize","updateOffset","scrollIntoPosition","currentScrollOffset","checkScrollStatus","getItemOffset","setItemOffset","debounce","func","wait","timeout","clearTimeout","currentKey","updateFirstKey","getCurrentFirstItem","updateCurrent","pageSize","currentStartOffset","scrollTargetToView","resolve","Promise","getOffsetByIndex","preDistance","distance","scrollToTargetOffset","targetOffset","bottomOffset","preScrollOffset","deep","onBeforeUpdate","onUpdated","RealList","ctx"],"mappings":"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"}